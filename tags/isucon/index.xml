<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>isucon on ggdG:wq!</title><link>https://ggdg.tkan.dev/tags/isucon/</link><description>Recent content in isucon on ggdG:wq!</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Thu, 17 Sep 2020 17:11:43 +0900</lastBuildDate><atom:link href="https://ggdg.tkan.dev/tags/isucon/index.xml" rel="self" type="application/rss+xml"/><item><title>ISUCON10予選に参加して敗北しました</title><link>https://ggdg.tkan.dev/post/isucon10/</link><pubDate>Thu, 17 Sep 2020 17:11:43 +0900</pubDate><guid>https://ggdg.tkan.dev/post/isucon10/</guid><description>@Rasino66 と2人で ISUCON10 の予選に参加してきました。
残念ながら本戦に出場は出来ませんでしたが、学びが多い面白い問題でした。
Discordで通話しつつ画面を共有してやり取りしていましたが、これは普段から同じ手法で2人オンライン読書会してたりするので、
特に困ることもなかったです。 コードの編集等は難しいことを考えずに直接サーバへSSHした上で、Vimで編集していました。
言語はGoを選択しました。
前半 最序盤はベンチマークが回せなかったので、事前に準備していた通りに以下を行いました。
ここまでは練習通りに出来ていて良かったです。
サーバに必要なものを入れる pt-query-digest kataribe Vimの設定等 MySQL, Nginxのログ周りを出力するように設定する マニュアルを読む 上記準備が終わった頃にはベンチマークが回せるようになっていたので、とりあえず初回のベンチマークを実行し、
MySQLのCPU使用率が支配的であることを確認しました。
pt-query-digestの結果から
以下にインデックスを追加し、スコアが少し延びたことを確認しましたが、依然としてMySQLのCPU使用率が高いことを確認したため、ダメそうな箇所を改善し始めました。
estateテーブル door_width door_height popularity rent chairテーブル price stock popularity どうも以下のようなクエリが実行されたときにインデックスを使えておらず、
詳しく見てみると popularity を DESC で ORDER BY, その後 id を ASCで ORDER BYしているのが駄目なようです。
mysql&amp;gt; explain SELECT * FROM estate WHERE rent &amp;gt;= 100000 AND rent &amp;lt; 150000 ORDER BY popularity DESC, id ASC LIMIT 25; +----+-------------+--------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+--------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+ | 1 | SIMPLE | estate | NULL | ALL | idx_rent | NULL | NULL | NULL | 29533 | 30.</description></item></channel></rss>